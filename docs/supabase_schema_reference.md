# Supabase Schema Reference for Forgeborn

This document outlines the key tables, fields, and relationships in the Supabase schema that supports the Forgeborn system. It provides a clear reference for developers, operators, and integration partners to understand the data model, enabling better debugging, reporting, and extensions.

---

## üìÅ Database: `forgeborn`

### üßæ Table: `llm_logs`

This table is used for logging agent interactions with LLMs (large language models) during runtime, decision making, and cognitive planning.

| Column Name | Type      | Description |
|-------------|-----------|-------------|
| `id`        | UUID      | Primary key, autogenerated |
| `rc_id`     | TEXT      | Runtime cycle identifier or task cycle ID |
| `agent`     | TEXT      | Name of the agent writing the log (e.g., `planning_agent_v1`) |
| `message`   | TEXT      | Log message content |
| `level`     | TEXT      | Log level/category (e.g., `rc_strategy`, `error`, `info`) |
| `timestamp` | TIMESTAMP | Server-side insertion timestamp |

**Indexes**:
- Primary key on `id`
- Index on `rc_id` for fast filtering by runtime context

---

## üîê Policies

The following RLS (Row Level Security) policies are recommended for this table:

### SELECT Policy
```sql
CREATE POLICY "Allow read access to logs"
ON forgeborn.llm_logs
FOR SELECT
USING (true);
```

### INSERT Policy
```sql
CREATE POLICY "Allow insert by anon and service role"
ON forgeborn.llm_logs
FOR INSERT
WITH CHECK (true);
```

Ensure both `anon` and `service_role` keys are correctly scoped to perform writes and reads depending on the use case.

---

## üì§ Insert Sample (cURL)

```bash
curl -X POST 'https://<project>.supabase.co/rest/v1/forgeborn.llm_logs' \
  -H "apikey: <SUPABASE_SERVICE_ROLE_KEY>" \
  -H "Content-Type: application/json" \
  -d '{
    "rc_id": "RC_SAMPLE",
    "agent": "planner",
    "message": "Agent began task planning.",
    "level": "info"
  }'
```

---

## üß© Future Tables (Planned Schema Expansion)

| Table Name         | Purpose                            |
|--------------------|------------------------------------|
| `blueprint_history`| Tracks blueprint revisions & versions |
| `agent_runs`       | Logs agent execution outcomes       |
| `system_metrics`   | Stores system-wide performance and anomaly logs |
| `vector_memory`    | Vector embeddings and search indices |

---

## üîç Supabase UI Guidance

- Confirm schema `forgeborn` is exposed via **Data API Settings**
- RLS should be tested using both `anon` and `service_role` JWT tokens
- Use `Logflare` or `Edge Logs` to debug 404 or silent insert failures

---

## üìì Developer Tips

- Prefer using `Prefer: return=representation` in POST headers when debugging inserts.
- Avoid policy mismatch by copying policy definitions directly into SQL editor for visibility.
- Index `rc_id` and `timestamp` for effective log filtering via dashboard or CLI.

---

Generated for: **Forgeborn Core**
Maintained by: **HILLSTRONG Group Security**